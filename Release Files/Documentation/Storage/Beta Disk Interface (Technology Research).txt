=======================================================
Beta Disk Interface TR-DOS 4 Manual for the ZX Spectrum
Technology Research Ltd
=======================================================

TECHNOLOGY RESEARCH BETA DISK INTERFACE -- TR-DOS v4

TR-DOS v4 for the Technology Research Beta Disk Interface Includes extra facilities and extends or modifies
some of the original commands . The password is no longer implemented.
The extra facilities are auto-boot, auto check of drive specification and file handling (both sequential and
random access). In addition, at the press of a button, the whole image of the RAM may be saved on the disk.
The image may be retrieved from the disk to the RAM with the program continuing to run from where it was
stopped. A reset button is also provided.

The FORMAT and the COPY commands are now in the operating system in addition to the utility programs
on the disk. The utility program on the disk is now called "FILER", which combines the facilities of "BACKUP",
"COPY" and "SCOPY" in TR-DOS v3. The CAT command has been extended while the LOAD and SAVE
commands have been modified.

This supplement explains these enhancements and should be used in conjunction with the user manual.

Contents

1 AUTO-BOOT
2 AUTO CHECK OF DRIVE SPECIFICATION
3 "40" COMMAND
4 "CAT" COMMAND
5 "LOAD" COMMAND
6 "SAVE" COMMAND
7 "COPY" COMMAND
8 "FORMAT" COMMAND
9 DISK ERROR
10 SEQUENTIAL AND RANDOM ACCESS FILE HANDLING
11 UTILITY PROGRAMS - TAPECOPY & FILER
12 RAM IMAGE SAVER AND LOADER
13 ADDITIONAL INFORMATION


TECHNOLOGY RESEARCH BETA DISK INTERFACE TR-DOS v4

1. AUTO-BOOT

When the Spectrum is turned on or reset, then TR-DOS v4 will try to load and run a Basic program named
"boot". If there is no disk in Drive A, or the drive door is open or the disk does not contain the Basic program
"boot", then an error message is displayed followed by the command line "RUN "boot"". You can run the
"boot" program by pressing the "ENTER" key, or you can delete the line and enter another command as
required.

Having a disk in the disk drive when the Spectrum power is turned on may corrupt the disk, particularly those
makes of drive with permanently loaded heads. It is therefore recommended that the "boot" disk be loaded
after the error message or the message be deleted as in the previous paragraph.
You can run or load the "boot" program by the following commands:
    RUN <ENTER>
    LOAD >ENTER>


2. AUTO CHECK DRIVE SPECIFICATION

TR-DOS v3 catered for disk drives with slow step rate, and fixed the step rate accordingly. TR-DOS v4
checks the step rate of disk drives and adjust the rate automatically. Thus modern drives with fast step rate
are fully utilised.
In addition, TR-DOS v4, automatically checks the drive specification, that i s, 40 or 80 track, single or double
sided and adjust Itself accordingly. The auto check may not work with some old 40 track disk drives because
they do not have end stop. However the "40" command may be used to inform the system that it is actually a
40 track drive.
The auto tests are carried out when power is applied to the Spectrum computer, but to do this, the disk drives
must be switched on. The tests will be carried out even if there is no disk in the drive. If the disk drives are
switches off , then the test will be carried out when that particular drive is selected.


3. "40" COMMAND

The auto check may not work with some old 40 track disk drives because they do not have end stop. That is,
the system thinks it is a 80 track drive. The "40" command informs the system that the currently selected
drive is actually a 40 track drive, Please note that the "FORMAT* command ignores the "40" command.
Therefore, to format a disk on this kind of drive, you must use the "FORMAT" utility program which is on the
disk supplied.


4. "CAT" COMMAND

4.1 The "CAT" command has been extended so that the listing of files can be dumped to a channel. TRDOS v3
displays the catalogue on the screen. In TR-DOS v4, it can also be sent to a channel.

For example:
    CAT #4 sends the listing of a catalogue to channel #4.
    CAT #6 "B:" sends the listing of a catalogue of drive B to channel #6.


4.2 The "CAT" command In the utility disk FILER program displays extended Information. An example of the
Information displayed by the FILER "CAT" command is as follows:

    Title: mydisk   Disk Drive: B
    3 File(s)       40 Track s. side
    1 del. file(s)  Free Sector 580
    File name       Start Length line
    filer <C> 32    32768 08000
    test <B> 5      00298 01200 100
    phone <#> 7     01780 01780

The display informs you that the name of the disk in drive B is "mydisk". It is 40 track single sided, with 3 files
stored and 1 file deleted. There are 580 free sectors remaining on the disk.
The 3 files are " filer", "test" and "phone", "filer" is a machine code program, occupying 32 sectors. The
starting and executing addresses are 32768 and the length of the program is 8000 bytes.
The basic program "test" will be auto-run at line 100, while "phone" is a data file (sequential or random
access).


5. "LOAD" COMMAND

The "LOAD" command has been changed. If a Basic program is saved with a line number, then when the file
is loaded from the disk, it will auto run at that line number.
If a Basic program is saved without a line number, then the program will be listed when the file is loaded from
the disk.
During loading and saving of files , the <BREAK> key may be used to abort the command. The commands
will be also aborted if there is no disk in the drive and "no disk" will be displayed on the screen.


6. "SAVE" COMMAND

The "SAVE" command has also been changed. When a machine code file is saved in TR-DOS v3. it is saved
as sectors. That is, if 10 bytes are to be saved, the system actually saves the whole 256 bytes (one sector)
from the starting address. And when the file is loaded, all 256 bytes are loaded into the memory.
In TR-DOS v4, this has been corrected, so that the exact number of bytes are saved and loaded. In order to
implement this change, the "execution address" has to be removed from the directory.
Therefore, to auto run a machina code file , the "executing address* must be the same as the "starting
address". If this is not so, than the RANDOMISE USR command can be used in BASIC.

For example:
    SAVE "TEST" CODE starting_address, length

When the program is run, it starts from the "starting_address".

For example:
    RUN "TEST" CODE

NOTE: Irrespective of the actual number of bytes saved the "CAT" command will show a sector. Thus 310
bytes saved will show, and use, 2 sectors of the disk.


7. "COPY" COMMAND

The "COPY" command is now implemented in the TR-DOS system instead of on the disk. This command is
used to copy files from one disk drive to another. The format is:

    COPY "destination file ", "source file" type
	
For example:
    COPY "B:test", "A:pie*
    COPY "A:new", "B:old" CODE
    COPY "B:new", "A:old" DATA

If you are copying all the files from disk drive A (source) to disk drive B (destination), then type

    COPY "B:*", "A:*"

If there is a file with the save name already existing on the destination disk drive, then the system will prompt
you with the following options:

    overwrite existing file ? (Y/N)
	
The file will be overwritten if you answer "Y".

If you want to duplicate or copy files from one disk to another disk using a single disk drive, then the "FILER"
utility program should be used.


8. "FORMAT" COMMAND

The "FORMAT" command is now implemented in the TR-DOS system in addition to the utility on the disk.
This command is used to prepare a blank new disk for storing files.

The command automatically checks the drive specification and will format the disk accordingly. The different
type of disk are as follows:

    40 track, single sided
    40 track, double sided
    80 track, single sided
    80 track, double sided.
	
For example

    FORMAT "mydisk"
	
When the formatting has been completed, the following is shown:

    mydisk
    624 / 624

where the first line is the name of the disk, and the first number is the number of free sectors on the disk, the
second is the maximum number of sectors. A track contains 16 sectors and there are 256 bytes in one
sector. Track 0 is reserved for system use.
Therefore, there are 39 * 16 = 624 tracks and 624 * 256 = 159744 bytes (156 Ko) in a 40 tracks, single sided
drive.

It is possible to force a double sided disk drive to format a disk as single sided by making the first character
of the disk name a "$". This is essential for use with the RAM SAVER (see section 12).
for example

    FORMAT "$mydisk"
	
	
9. DISK ERROR

If a disk error occurs, TR-DOS v4 will display an error message such as "write protected" or "disk error",
followed by the track sector number where the error has occurred. There are 3 options available, you can
type "R" to re-try. "A" to abort the operation or "I" to ignore that track and sector and continue with the rest of
the disk operations.


10. SEQUENTIAL AND RANDOM ACCESS FILE HANDLING

10.1 General description

Normal datafiles, e.g. SAVE(LOAD) "name"a$(), produced by many programs are still handled as in TR-DOS
v3. The "CAT" command identifies these as type <D>.

There are now two additional types of datafiles, sequential and random access. In order to use these
datafiles, you must first open a channel. The Spectrum contains 16 channels. Channels #0 to #3 are
reserved for the computer. You can use channels #4 to #15.
When a disk channel is open for file handling. 336 bytes of RAM are used. When the "CAT* command is
used to list the catalogue, these datafiles are distinguished from other types by <#>.

For example

    TEST <#>

Both numeric and string variables may be stored in the datafiles. Numeric variables are converted into
strings by the computer before being put into data file . The string is terminated by a carriage return (ASCII
code 13).
The sequential file stores the data serially . In order to read a string towards the end of these files , it is
necessary to start from the very beginning. The random access file stores data as a number of records. Any
record in these files may be read or written by specifying the record number.

The sequential and random access files may be erased, renamed or copied as files of other types.

For example:

    ERASE "namadd" #
    NEW "newfile", "oldfile" #
    COPY "B:phone","A:phone" #


10.2 Sequential Files

A sequential file may be opened either for write or read, but not both at the same time. To open a file for
write, the command format is:

    OPEN channel_number,"filename"W

When a channel is opened for write, the basic "PRINT" command can be used to write data to this channel.

For example:

    10 LET DOS=15363
    20 RANDOMISE USR DOS:REM: OPEN #4 "test"W
    30 PRINT #4: "This is a test line ."
    40 RANDOMISE USR DOS: REM: CLOSE #4
	
The string in line 30 will be saved in file "test" on the disk. When a write file is opened, the contents will be
lost if the power is turned off before the file is closed. The file is closed by closing the channel, as in line 40.
Any file which is closed may be reopened for a further write operation by reading, adding and re-saving under
a new name or after erasing the first name.

To open a file for read, the command format is:

    OPEN #4 "filename"R
	
When a channel is opened for read, the basic "INPUT" command can be used to read data from this
channel.

For example:

    10 LET DOS=15363
    20 RANDOMISE USR DOS: REM: OPEN #7,"test"R
    30 INPUT #7: A$
    40 CLOSE #7
	
The data file "test" will be loaded to A$ from the disk.


10.3 Random access files

All "OPEN" and "CLOSE" commands require the usual RANDOMISE USR 15363:REM:
prefix, but not the "PRINT" or "INPUT" commands.

To open a file for random access, the command format is:

    OPEN channel_number, "filename",RND, record_length

For example

    OPEN #12 ,"test01"RND, 20

In this example, channel #12 is open for the random access file "test1" with a record length of 20 characters.
The maximum record length is 255 bytes.

The record is stored as a single string. If the string is less than the record length, it is stored left justified
and is terminated by a carriage return (ASCII code 13) the remaining bytes are not defined. If the string is
longer than the record length, then it will be truncated to be the same as the record length, and stored
without the carriage return terminator.

A record may contain more than one variable. However it is the responsibility of the program to link together
the strings of those variables into a single string for the write operation. The string must be split up during the
read operation.

To write a record to a file, the command format is:

    PRINT channel_number; record_number, variable_name

For example:

    PRINT #4: 20, A$
	
The content of A$ is put in record number 20 (21st record). The first record number is 0. The contents will be
lost if the power is turned off before the file is closed. A file is closed by closing the channel.

To read the record from a file, the command forma is:

    INPUT channel_number; (record_number), variable_name
	
For example:

    INPUT #4: (15), A$
	
The record in record number 15 (16th record) is read and loaded to variable A$.


11. UTILITY PROGRAMS - TAPECOPY & FILER

There are three utility program to the disk supplied. The "FORMAT" program is the same as TR-DOS v3.
The "TAPECOPY" program allows you to transfer programs from cassette to disk. And the "FILER" program
replaces three utility programs in TR-DOS v3, namely, "BACKUP", "COPY" and "SOOPY".


11.1 TAPECOPY

In many cases you may want to transfer programs from cassette to disk. This program allows you to copy
most programs onto disk. It can copy BASIC, CODE, ARRAY and DATA file stored on tape, providing that
the length of the program is not greater than 40,000 bytes.

To execute this program, type

    RUN "tapecopy" <ENTER>
	
You will get the following display:

           TAPE TO DISK COPIER VER 4.0
           TECHNOLOGY RESEARCH LTD

    DATA TYPE:
    FILENAME:
    CODE LENGTH:
    START LINE:
    BASIC LENGTH:
	
    PRESS [BREAK] TO STOP
    
	      START TAPE
	
The program will wait for you to play the tape. Once the tape HEADER is read, the display will show the
data type, filename, code length, start line and basic length.

For example, if a BASIC called example (with auto-run line number 1000 and length of 15000 bytes) is
loaded, then the display will be shown as:

           TAPE TO DISK COPIER VER 4.0
           TECHNOLOGY RESEARCH LTD
		   
    DATA TYPE: BASIC
    FILENAME: EXAMPLE
    CODE LENGTH: 15000
    START LINE: 01000
    BASIC LENGTH: 15000
	
    PRESS [BREAK] TO 5TOP

          STOP TAPE

When a file has loaded, the display will inform you to stop the tape, the program is then stored on the disk
with the same name as that stored on the tape. If a file with the same name has already existed on the disk,
then it will be overwritten.

This process will repeat itself until you press the <BR£AX> key.

The "TAPECOPY" program has its limitations, they are:

1  It can only transfer programs stored in standard format, i.e. with header information.
2  It cannot transfer programs which are not in standard format, e.g. headless recordings.
3  It cannot transfer protected programs.
4  Programs must not be longer than 40,000 bytes.
5  Programs transferred to disk may still have to be modified to enable the user to use the disk
   facilities (refer to sections E & F, page 19-20 in the User Manual).

The messages which my be encountered are:

START TAPE:         Press the play key on the cassette recorder to start loading.
STOP TAPE:          Stop the cassette recorder.
TAPE LOAD ERROR     Errors encountered in loading, rewind tape and try again.
NOT ENOUGH MEMORY   This message tells you that you are trying to transfer programs greater than 40000 bytes
                    long. If so, you can still transfer program by noting down the header information displayed.


11.2 FILER

The "FILLR" program replaces "BACKUP", "COPY" and "SCOPY" utility programs in TR-DOS v3. In addition,
the "CAT" and the "COPY" commands have also been enhanced.

To execute this program, type

    RUN "filer" <ENTER>
	
The display in the screen will be:

           FILER ver 4.0
    © 1984 Technology Research Ltd.

Commands are:

    CAT                        List of file name
    NEW "newfile", "oldfile"   Rename
    ERASE "filename"           Erase a file
    MOVE                       Remove empty gaps
    RETURN                     Return to System
    FORMAT "name"              Format new disk
    COPY "new","old"           Copy file
    COPY "b: *" , ' 'a:*"      Copy all files
    COPY s "file"              Single drive copy
    COPY b                     Backup whole disk

    A*

The FILER "CAT" facility is fully covered in section 4.2. Single drive copy "SCOPY" is replaced by the "COPY
s" command, and the "BACKUP" is replaced by the "COPY b" command.


12 RAM IMAGE SAVER AND LOADER

When the button on the back of the interface is pressed, the whole image of the computer's memory (48
kbytes! will be stored on the disk, so that the program which is running may be continued on a later day.

The following sequence show you the detailed operations.

1  Format a single sided disk (see "FORMAT" command, section 8).
2  Insert the disk in drive A, if it is not already there.
3  Return to BASIC.
4  Reset the Spectrum by typing: PRINT USR 0 <ENTER>
5  Load and run the program from cassette tape as normal.
6  After the program has loaded and is running, press the button on the back of the Interface, and
   release the button promptly.
   The RAM image will then be saved on the disk.

Note that the disk must be formatted as single sided and it must be in drive A. The name of this file is " " and
the type is CODE.
The file is stored in track 1 to 12. If there were files stored in track 1 to 12 on the disk, they will be
overwritten.

This file may be renamed using the "NEW* command or it may be copied to another disk. The command "GO TO"
is used to load and run the image file. During the loading of the file, you will see some random display
on the screen. And when the loading has been completed, the computer will continue to run the program
from where it was stopped.

To load and run the saved image, type

    GO TO "filename"CODE <ENTER>
	
Note: some games programs use a non-standard key scan routine. If a program does not work after loading
from the disk, you must change the name of the file to begin with a "$".

For example:

    NEW "$test", ""CODE <ENTER>
	
Then you can run the program by typing

    GO TO "$test"CODE <ENTER>
	
	
11 ADDITIONAL INFORMATION

The disk system requires a buffer of 256 bytes (one sector), the printer buffer of the Spectrum computer is
used. However, before the printer buffer is used, it is saved in a free sector on the system track (track 0) of
the disk. When the operation has been completed, the printer buffer is re-loaded from the disk, if the disk is
write protected the printer buffer will be lost.